/* 
 * File:   comm.h
 * Author: MLTop
 *
 * Created on February 9, 2016, 4:48 AM
 */

#ifndef COMM_H
#define	COMM_H

#ifdef	__cplusplus
extern "C" {
#endif
///////////////////////////////////////////////////////////////////////////////
// Roles / Msg Sources
///////////////////////////////////////////////////////////////////////////////
#define CLIENT_ROLE         0x00
#define LEAD_ROVER          0x01
#define FOLLOWER            0x02
#define SENSORS             0x04
#define COORDINATOR         0x08
#define MONITOR             0x10

///////////////////////////////////////////////////////////////////////////////    
// Define This Device's Role
///////////////////////////////////////////////////////////////////////////////
#define MY_ROLE CLIENT_ROLE
    
///////////////////////////////////////////////////////////////////////////////
// Message and buffer sizes
///////////////////////////////////////////////////////////////////////////////
#define MAX_MSG_SIZE 16
#define OUT_BUF_SIZE 16
#define IN_BUF_SIZE 16
#define INTERNAL_MSG_SIZE 4

///////////////////////////////////////////////////////////////////////////////
// Message Structure for network communication
// Msg Src | Msg Num | Msg Type | Payload Size | Payload | Checksum | ACK 
///////////////////////////////////////////////////////////////////////////////
typedef unsigned MSG_FIELD;  
typedef struct{

    MSG_FIELD MSG_START:8;
    MSG_FIELD MSG_SRC:8;
    MSG_FIELD MSG_NUM:8;
    MSG_FIELD MSG_TYPE:8;
    MSG_FIELD PAYLOAD_SIZE:8;
    MSG_FIELD PAYLOAD:32;
    MSG_FIELD CHKSUM:16;
    MSG_FIELD ACK_FIELD:8;
    
} TEAM1_MSG;

///////////////////////////////////////////////////////////////////////////////
// Message Types
///////////////////////////////////////////////////////////////////////////////
#define CLIENT_ROLE         0x00
#define INITIALIZE          0x01
#define READY_TO_START      0x02
#define LEAD_PO             0x04
#define FOLLOW_PO           0x08
#define OBS_INFO            0x10
#define MOTOR_FB            0x11
#define ROVER_CMD           0x12
#define TOKEN_FOUND         0x14

///////////////////////////////////////////////////////////////////////////////
// Payload Configs
///////////////////////////////////////////////////////////////////////////////
#define PAYLOAD_4BYTE   4
#define PAYLOAD_3BYTE   3
#define PAYLOAD_2BYTE   2
#define PAYLOAD_1BYTE   1

///////////////////////////////////////////////////////////////////////////////
// Internal message structure for passing between threads
///////////////////////////////////////////////////////////////////////////////
typedef struct{

    char INTERNAL_TYPE;
    char INTERNAL_MESSAGE[INTERNAL_MSG_SIZE];
    
}INTERNAL_MSG;

#ifdef	__cplusplus
}
#endif

#endif	/* COMM_H */

